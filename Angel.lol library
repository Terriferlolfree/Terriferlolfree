local uis = game:GetService("UserInputService")
local players = game:GetService("Players")
local ws = game:GetService("Workspace")
local http_service = game:GetService("HttpService")
local coregui = game:GetService("CoreGui")

local rgb = Color3.fromRGB
local dim2 = UDim2.new

if getgenv().library then
	getgenv().library:unload()
end

-- library init
getgenv().library = {
	flags = {},
	config_flags = {},
	connections = {},
	notifications = {},
	instances = {},
	main_frame = {},
	gui,
	sin = 0,
}

local flags = library.flags
local config_flags = library.config_flags

local themes = {
	preset = {
		["accent"] = rgb(100, 100, 255),
		["text"] = rgb(170, 170, 170),
		["unselected_text"] = rgb(90, 90, 90),
	}
}

library.__index = library

function library:create(instance, options)
	local ins = Instance.new(instance)
	for prop, value in next, options do
		ins[prop] = value
	end
	return ins
end

function library:connection(signal, callback)
	local connection = signal:Connect(callback)
	table.insert(library.connections, connection)
	return connection
end

-- Mobile toggle button function
function library:mobile_toggle_button()
    local mobile_toggle = library:create("TextButton", {
        Parent = library.gui,
        Name = "MobileToggle",
        Text = "☰",
        BackgroundColor3 = themes.preset.accent,
        TextColor3 = rgb(255, 255, 255),
        BorderColor3 = Color3.fromRGB(0, 0, 0),
        Size = UDim2.new(0, 40, 0, 40),
        Position = UDim2.new(1, -50, 0, 10),
        ZIndex = 9999,
        Visible = uis.TouchEnabled,
        TextSize = 20,
        BackgroundTransparency = 0.3,
    })
    
    local corner = library:create("UICorner", {
        Parent = mobile_toggle,
        CornerRadius = UDim.new(0, 20)
    })
    
    local toggled = false
    
    mobile_toggle.MouseButton1Click:Connect(function()
        toggled = not toggled
        for _, frame in ipairs(library.main_frame) do
            frame.Visible = toggled
        end
        mobile_toggle.Text = toggled and "✕" or "☰"
        mobile_toggle.Position = toggled and UDim2.new(0, 10, 0, 10) or UDim2.new(1, -50, 0, 10)
    end)
    
    return mobile_toggle
end

library.gui = library:create("ScreenGui", {
	Enabled = true,
	Parent = coregui,
	Name = "CompactUI",
	DisplayOrder = 2,
	ZIndexBehavior = 1,
})

function library:window(properties)
	local cfg = {
		name = properties.Name or "Compact UI",
		size = dim2(0, 380, 0, 450),
	}

	-- Main Window
	local mainWindow = library:create("Frame", {
		Parent = library.gui,
		Name = "MainWindow",
		Active = true,
		Draggable = true,
		Position = dim2(0.5, -190, 0.5, -225),
		BorderColor3 = rgb(8, 8, 8),
		ZIndex = 2,
		Size = cfg.size,
		BackgroundColor3 = rgb(40, 40, 40),
	})
	table.insert(library.main_frame, mainWindow)

	local accent_line = library:create("Frame", {
		Parent = mainWindow,
		Name = "AccentLine",
		BorderColor3 = rgb(34, 34, 34),
		Size = dim2(1, 0, 0, 2),
		BorderSizePixel = 0,
		BackgroundColor3 = themes.preset.accent,
	})

	local title = library:create("TextLabel", {
		Parent = mainWindow,
		Name = "Title",
		Font = Enum.Font.SourceSans,
		TextColor3 = themes.preset.text,
		BorderColor3 = rgb(0, 0, 0),
		Text = cfg.name,
		BorderSizePixel = 0,
		BackgroundTransparency = 1,
		Position = dim2(0, 8, 0, -1),
		Size = dim2(1, -16, 0, 1),
		ZIndex = 2,
		TextSize = 14,
	})

	-- Tab buttons
	local tabButtons = library:create("Frame", {
		Parent = mainWindow,
		Name = "TabButtons",
		BorderColor3 = rgb(0, 0, 0),
		BackgroundTransparency = 1,
		Position = dim2(0, 16, 0, 4),
		Size = dim2(1, -32, 0, 30),
		ZIndex = 2,
	})

	local list = library:create("UIListLayout", {
		Parent = tabButtons,
		Name = "TabListLayout",
		FillDirection = Enum.FillDirection.Horizontal,
		HorizontalAlignment = Enum.HorizontalAlignment.Center,
		Padding = UDim.new(0, 10),
	})

	-- Tab content area
	local tabContent = library:create("Frame", {
		Parent = mainWindow,
		Name = "TabContent",
		Position = dim2(0, 15, 0, 40),
		BorderColor3 = rgb(19, 19, 19),
		Size = dim2(1, -30, 1, -55),
		BorderSizePixel = 0,
		BackgroundColor3 = rgb(22, 22, 22),
	})

	cfg["tab_holder"] = tabButtons
	cfg["tab_instance_holder"] = tabContent

	-- Create mobile toggle button if on mobile
	if uis.TouchEnabled then
		library:mobile_toggle_button()
	end

	return setmetatable(cfg, library)
end

function library:tab(properties)
	local cfg = {
		name = properties.name or "Tab",
	}

	-- Tab Button
	local tabButton = library:create("TextButton", {
		Parent = self.tab_holder,
		Name = "TabButton_" .. cfg.name,
		Font = Enum.Font.SourceSans,
		TextColor3 = themes.preset.unselected_text,
		BorderColor3 = rgb(0, 0, 0),
		Text = cfg.name,
		BackgroundTransparency = 1,
		Size = dim2(0, 100, 0, 30),
		BorderSizePixel = 0,
		TextSize = 14,
	})

	-- Tab Content
	local tabContent = library:create("Frame", {
		Parent = self.tab_instance_holder,
		Name = "TabContent_" .. cfg.name,
		Visible = false,
		BorderColor3 = rgb(0, 0, 0),
		BackgroundTransparency = 1,
		Size = dim2(1, 0, 1, 0),
	})

	-- Left column
	local leftColumn = library:create("Frame", {
		Parent = tabContent,
		Name = "LeftColumn",
		BorderColor3 = rgb(0, 0, 0),
		BackgroundTransparency = 1,
		Size = dim2(0.5, -5, 1, 0),
	})

	-- Right column
	local rightColumn = library:create("Frame", {
		Parent = tabContent,
		Name = "RightColumn",
		BorderColor3 = rgb(0, 0, 0),
		BackgroundTransparency = 1,
		Position = dim2(0.5, 5, 0, 0),
		Size = dim2(0.5, -5, 1, 0),
	})

	cfg["left"] = leftColumn
	cfg["right"] = rightColumn

	function cfg.open_tab()
		if library.current_tab then
			library.current_tab[1].TextColor3 = themes.preset.unselected_text
			library.current_tab[2].Visible = false
		end

		library.current_tab = {tabButton, tabContent}
		tabButton.TextColor3 = themes.preset.accent
		tabContent.Visible = true
	end

	tabButton.MouseButton1Click:Connect(cfg.open_tab)

	return setmetatable(cfg, library)
end

function library:section(properties)
	local cfg = {
		name = properties.name or "Section",
		side = properties.side or "left",
	}

	-- Section container
	local section = library:create("Frame", {
		Parent = self[cfg.side],
		Name = "Section_" .. cfg.name,
		BorderColor3 = rgb(0, 0, 0),
		BackgroundTransparency = 1,
		Size = dim2(1, 0, 0, 0),
		AutomaticSize = Enum.AutomaticSize.Y,
	})

	-- Section title
	local title = library:create("TextLabel", {
		Parent = section,
		Name = "SectionTitle",
		Font = Enum.Font.SourceSans,
		TextColor3 = themes.preset.text,
		BorderColor3 = rgb(0, 0, 0),
		Text = cfg.name,
		BorderSizePixel = 0,
		Size = dim2(1, 0, 0, 20),
		BackgroundTransparency = 1,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextSize = 14,
	})

	-- Elements container
	local elements = library:create("Frame", {
		Parent = section,
		Name = "Elements",
		BorderColor3 = rgb(0, 0, 0),
		BackgroundTransparency = 1,
		Position = dim2(0, 0, 0, 20),
		Size = dim2(1, 0, 0, 0),
		AutomaticSize = Enum.AutomaticSize.Y,
	})

	local listLayout = library:create("UIListLayout", {
		Parent = elements,
		Name = "ElementListLayout",
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 5),
	})

	cfg["holder"] = elements
	return setmetatable(cfg, library)
end

function library:toggle(properties)
	local cfg = {
		name = properties.name or "Toggle",
		flag = properties.flag or "toggle_" .. math.random(1, 9999),
		callback = properties.callback or function() end,
		default = properties.default or false,
	}

	-- Toggle container
	local toggleContainer = library:create("Frame", {
		Parent = self.holder,
		Name = "Toggle_" .. cfg.name,
		BorderColor3 = rgb(0, 0, 0),
		BackgroundTransparency = 1,
		Size = dim2(1, 0, 0, 20),
	})

	-- Toggle label
	local label = library:create("TextLabel", {
		Parent = toggleContainer,
		Name = "Label",
		Font = Enum.Font.SourceSans,
		TextColor3 = themes.preset.text,
		BorderColor3 = rgb(0, 0, 0),
		Text = cfg.name,
		BorderSizePixel = 0,
		Size = dim2(1, -40, 1, 0),
		BackgroundTransparency = 1,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextSize = 12,
	})

	-- Toggle button
	local toggleButton = library:create("TextButton", {
		Parent = toggleContainer,
		Name = "ToggleButton",
		Font = Enum.Font.SourceSans,
		TextColor3 = rgb(0, 0, 0),
		BorderColor3 = rgb(0, 0, 0),
		Text = cfg.default and "✓" or "",
		Position = dim2(1, -30, 0, 0),
		Size = dim2(0, 30, 0, 20),
		TextSize = 12,
		BackgroundColor3 = cfg.default and themes.preset.accent or rgb(38, 38, 38),
	})

	function cfg.set(bool)
		flags[cfg.flag] = bool
		toggleButton.Text = bool and "✓" or ""
		toggleButton.BackgroundColor3 = bool and themes.preset.accent or rgb(38, 38, 38)
		cfg.callback(bool)
	end

	toggleButton.MouseButton1Click:Connect(function()
		cfg.set(not flags[cfg.flag])
	end)

	cfg.set(cfg.default)
	config_flags[cfg.flag] = cfg.set

	return setmetatable(cfg, library)
end

function library:slider(properties)
	local cfg = {
		name = properties.name or "Slider",
		flag = properties.flag or "slider_" .. math.random(1, 9999),
		callback = properties.callback or function() end,
		min = properties.min or 0,
		max = properties.max or 100,
		default = properties.default or 50,
		suffix = properties.suffix or "",
	}

	-- Slider container
	local sliderContainer = library:create("Frame", {
		Parent = self.holder,
		Name = "Slider_" .. cfg.name,
		BorderColor3 = rgb(0, 0, 0),
		BackgroundTransparency = 1,
		Size = dim2(1, 0, 0, 40),
	})

	-- Slider label
	local label = library:create("TextLabel", {
		Parent = sliderContainer,
		Name = "Label",
		Font = Enum.Font.SourceSans,
		TextColor3 = themes.preset.text,
		BorderColor3 = rgb(0, 0, 0),
		Text = cfg.name,
		BorderSizePixel = 0,
		Size = dim2(1, 0, 0, 15),
		BackgroundTransparency = 1,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextSize = 12,
	})

	-- Slider track
	local sliderTrack = library:create("Frame", {
		Parent = sliderContainer,
		Name = "SliderTrack",
		BorderColor3 = rgb(0, 0, 0),
		Position = dim2(0, 0, 0, 20),
		Size = dim2(1, 0, 0, 10),
		BackgroundColor3 = rgb(38, 38, 38),
	})

	-- Slider fill
	local sliderFill = library:create("Frame", {
		Parent = sliderTrack,
		Name = "SliderFill",
		BorderColor3 = rgb(0, 0, 0),
		Size = dim2(0, 0, 1, 0),
		BackgroundColor3 = themes.preset.accent,
	})

	-- Value label
	local valueLabel = library:create("TextLabel", {
		Parent = sliderContainer,
		Name = "ValueLabel",
		Font = Enum.Font.SourceSans,
		TextColor3 = themes.preset.text,
		BorderColor3 = rgb(0, 0, 0),
		Text = tostring(cfg.default) .. cfg.suffix,
		BorderSizePixel = 0,
		Position = dim2(0, 0, 0, 30),
		Size = dim2(1, 0, 0, 10),
		BackgroundTransparency = 1,
		TextXAlignment = Enum.TextXAlignment.Right,
		TextSize = 11,
	})

	local dragging = false

	function cfg.set(value)
		value = math.clamp(value, cfg.min, cfg.max)
		flags[cfg.flag] = value
		local percentage = (value - cfg.min) / (cfg.max - cfg.min)
		sliderFill.Size = dim2(percentage, 0, 1, 0)
		valueLabel.Text = tostring(value) .. cfg.suffix
		cfg.callback(value)
	end

	sliderTrack.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			local xPos = input.Position.X - sliderTrack.AbsolutePosition.X
			local percentage = math.clamp(xPos / sliderTrack.AbsoluteSize.X, 0, 1)
			local value = cfg.min + (percentage * (cfg.max - cfg.min))
			cfg.set(value)
		end
	end)

	uis.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local xPos = input.Position.X - sliderTrack.AbsolutePosition.X
			local percentage = math.clamp(xPos / sliderTrack.AbsoluteSize.X, 0, 1)
			local value = cfg.min + (percentage * (cfg.max - cfg.min))
			cfg.set(value)
		end
	end)

	uis.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)

	cfg.set(cfg.default)
	config_flags[cfg.flag] = cfg.set

	return setmetatable(cfg, library)
end

function library:colorpicker(properties)
	local cfg = {
		name = properties.name or "Color Picker",
		flag = properties.flag or "color_" .. math.random(1, 9999),
		callback = properties.callback or function() end,
		default = properties.default or Color3.fromRGB(255, 255, 255),
	}

	-- Color picker container
	local colorContainer = library:create("Frame", {
		Parent = self.holder,
		Name = "ColorPicker_" .. cfg.name,
		BorderColor3 = rgb(0, 0, 0),
		BackgroundTransparency = 1,
		Size = dim2(1, 0, 0, 40),
	})

	-- Color label
	local label = library:create("TextLabel", {
		Parent = colorContainer,
		Name = "Label",
		Font = Enum.Font.SourceSans,
		TextColor3 = themes.preset.text,
		BorderColor3 = rgb(0, 0, 0),
		Text = cfg.name,
		BorderSizePixel = 0,
		Size = dim2(1, -50, 0, 15),
		BackgroundTransparency = 1,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextSize = 12,
	})

	-- Color preview
	local colorPreview = library:create("TextButton", {
		Parent = colorContainer,
		Name = "ColorPreview",
		Text = "",
		Position = dim2(1, -40, 0, 0),
		Size = dim2(0, 40, 0, 40),
		BackgroundColor3 = cfg.default,
	})

	-- Color picker popup
	local colorPopup = library:create("Frame", {
		Parent = library.gui,
		Name = "ColorPopup",
		Position = dim2(0, colorPreview.AbsolutePosition.X, 0, colorPreview.AbsolutePosition.Y + 45),
		Size = dim2(0, 150, 0, 150),
		BackgroundColor3 = rgb(38, 38, 38),
		BorderColor3 = rgb(0, 0, 0),
		Visible = false,
		ZIndex = 9999,
	})

	local colorCanvas = library:create("ImageLabel", {
		Parent = colorPopup,
		Name = "ColorCanvas",
		Position = dim2(0, 5, 0, 5),
		Size = dim2(1, -10, 1, -35),
		BackgroundColor3 = Color3.new(1, 1, 1),
		Image = "rbxassetid://14036211188",
	})

	local hueSlider = library:create("Frame", {
		Parent = colorPopup,
		Name = "HueSlider",
		Position = dim2(0, 5, 1, -25),
		Size = dim2(1, -10, 0, 10),
		BackgroundColor3 = Color3.new(1, 0, 0),
	})

	local closeButton = library:create("TextButton", {
		Parent = colorPopup,
		Name = "CloseButton",
		Text = "✓",
		Position = dim2(1, -20, 1, -20),
		Size = dim2(0, 15, 0, 15),
		BackgroundColor3 = rgb(50, 50, 50),
		TextColor3 = rgb(255, 255, 255),
		TextSize = 10,
	})

	function cfg.set(color)
		flags[cfg.flag] = color
		colorPreview.BackgroundColor3 = color
		cfg.callback(color)
	end

	colorPreview.MouseButton1Click:Connect(function()
		colorPopup.Visible = not colorPopup.Visible
	end)

	closeButton.MouseButton1Click:Connect(function()
		colorPopup.Visible = false
	end)

	-- Simple color picking
	colorCanvas.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			local x = (input.Position.X - colorCanvas.AbsolutePosition.X) / colorCanvas.AbsoluteSize.X
			local y = (input.Position.Y - colorCanvas.AbsolutePosition.Y) / colorCanvas.AbsoluteSize.Y
			x = math.clamp(x, 0, 1)
			y = math.clamp(y, 0, 1)
			local color = Color3.fromHSV(x, 1 - y, 1)
			cfg.set(color)
		end
	end)

	hueSlider.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			local x = (input.Position.X - hueSlider.AbsolutePosition.X) / hueSlider.AbsoluteSize.X
			x = math.clamp(x, 0, 1)
			local hue = x
			local currentColor = flags[cfg.flag] or cfg.default
			local _, s, v = currentColor:ToHSV()
			local color = Color3.fromHSV(hue, s, v)
			cfg.set(color)
		end
	end)

	cfg.set(cfg.default)
	config_flags[cfg.flag] = cfg.set

	return setmetatable(cfg, library)
end

function library:dropdown(properties)
	local cfg = {
		name = properties.name or "Dropdown",
		flag = properties.flag or "dropdown_" .. math.random(1, 9999),
		items = properties.items or {"Option 1", "Option 2", "Option 3"},
		callback = properties.callback or function() end,
		default = properties.default or properties.items and properties.items[1],
	}

	-- Dropdown container
	local dropdownContainer = library:create("Frame", {
		Parent = self.holder,
		Name = "Dropdown_" .. cfg.name,
		BorderColor3 = rgb(0, 0, 0),
		BackgroundTransparency = 1,
		Size = dim2(1, 0, 0, 30),
	})

	-- Dropdown label
	local label = library:create("TextLabel", {
		Parent = dropdownContainer,
		Name = "Label",
		Font = Enum.Font.SourceSans,
		TextColor3 = themes.preset.text,
		BorderColor3 = rgb(0, 0, 0),
		Text = cfg.name,
		BorderSizePixel = 0,
		Size = dim2(1, 0, 0, 15),
		BackgroundTransparency = 1,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextSize = 12,
	})

	-- Dropdown button
	local dropdownButton = library:create("TextButton", {
		Parent = dropdownContainer,
		Name = "DropdownButton",
		Font = Enum.Font.SourceSans,
		TextColor3 = themes.preset.text,
		BorderColor3 = rgb(0, 0, 0),
		Text = cfg.default or "Select...",
		Position = dim2(0, 0, 0, 15),
		Size = dim2(1, 0, 0, 25),
		BackgroundColor3 = rgb(38, 38, 38),
		TextSize = 12,
	})

	-- Dropdown options
	local optionsPopup = library:create("Frame", {
		Parent = library.gui,
		Name = "OptionsPopup",
		Position = dim2(0, dropdownButton.AbsolutePosition.X, 0, dropdownButton.AbsolutePosition.Y + 30),
		Size = dim2(0, dropdownButton.AbsoluteSize.X, 0, #cfg.items * 25 + 10),
		BackgroundColor3 = rgb(30, 30, 30),
		BorderColor3 = rgb(0, 0, 0),
		Visible = false,
		ZIndex = 9999,
	})

	local optionsList = library:create("Frame", {
		Parent = optionsPopup,
		Name = "OptionsList",
		Position = dim2(0, 5, 0, 5),
		Size = dim2(1, -10, 1, -10),
		BackgroundTransparency = 1,
	})

	local listLayout = library:create("UIListLayout", {
		Parent = optionsList,
		Name = "OptionsLayout",
		SortOrder = Enum.SortOrder.LayoutOrder,
	})

	function cfg.set(value)
		flags[cfg.flag] = value
		dropdownButton.Text = value
		optionsPopup.Visible = false
		cfg.callback(value)
	end

	dropdownButton.MouseButton1Click:Connect(function()
		optionsPopup.Visible = not optionsPopup.Visible
	end)

	-- Create options
	for _, item in ipairs(cfg.items) do
		local optionButton = library:create("TextButton", {
			Parent = optionsList,
			Name = "Option_" .. item,
			Font = Enum.Font.SourceSans,
			TextColor3 = themes.preset.text,
			BorderColor3 = rgb(0, 0, 0),
			Text = item,
			Size = dim2(1, 0, 0, 25),
			BackgroundColor3 = rgb(45, 45, 45),
			TextSize = 12,
		})

		optionButton.MouseButton1Click:Connect(function()
			cfg.set(item)
		end)
	end

	if cfg.default then
		cfg.set(cfg.default)
	end

	config_flags[cfg.flag] = cfg.set

	return setmetatable(cfg, library)
end

function library:notification(properties)
	local cfg = {
		text = properties.text or "Notification",
		time = properties.time or 3,
	}

	local notification = library:create("Frame", {
		Parent = library.gui,
		Name = "Notification",
		Position = dim2(1, -220, 0, 10),
		Size = dim2(0, 200, 0, 50),
		BackgroundColor3 = rgb(38, 38, 38),
		BorderColor3 = rgb(0, 0, 0),
		ZIndex = 9999,
	})

	local textLabel = library:create("TextLabel", {
		Parent = notification,
		Name = "Text",
		Font = Enum.Font.SourceSans,
		TextColor3 = rgb(255, 255, 255),
		Text = cfg.text,
		Size = dim2(1, -10, 1, -10),
		Position = dim2(0, 5, 0, 5),
		BackgroundTransparency = 1,
		TextSize = 14,
		TextWrapped = true,
	})

	-- Fade in/out animation
	notification.BackgroundTransparency = 1
	textLabel.TextTransparency = 1
	
	-- Fade in
	for i = 0, 1, 0.1 do
		notification.BackgroundTransparency = 1 - i
		textLabel.TextTransparency = 1 - i
		wait(0.02)
	end
	
	-- Wait
	wait(cfg.time)
	
	-- Fade out
	for i = 0, 1, 0.1 do
		notification.BackgroundTransparency = i
		textLabel.TextTransparency = i
		wait(0.02)
	end
	
	notification:Destroy()
end

function library:unload()
	library.gui:Destroy()
	for _, connection in ipairs(library.connections) do
		connection:Disconnect()
	end
	getgenv().library = nil
end

-- Example usage function
function library:example()
	local window = library:window({
		Name = "Compact UI Example"
	})
	
	-- Tab 1
	local tab1 = window:tab({
		name = "Tab 1"
	})
	
	local leftSection1 = tab1:section({
		name = "Left Section",
		side = "left"
	})
	
	local rightSection1 = tab1:section({
		name = "Right Section",
		side = "right"
	})
	
	-- Library Table
local library = {connections = {}}

-- Main GUI Container
library.gui = Instance.new("ScreenGui")
library.gui.Name = "CompactUILibrary"
library.gui.Parent = game:GetService("CoreGui") or game.Players.LocalPlayer:WaitForChild("PlayerGui")

-- Window Creation Method
function library:window(config)
    local window = {}
    window.tabs = {}
    
    -- Window GUI Frame
    window.mainFrame = Instance.new("Frame")
    window.mainFrame.Size = UDim2.new(0, 500, 0, 400)
    window.mainFrame.Position = UDim2.new(0.5, -250, 0.5, -200)
    window.mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    window.mainFrame.Parent = library.gui
    
    -- Window Title
    window.title = Instance.new("TextLabel")
    window.title.Text = config.Name or "Window"
    window.title.Size = UDim2.new(1, 0, 0, 30)
    window.title.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    window.title.TextColor3 = Color3.fromRGB(255, 255, 255)
    window.title.Parent = window.mainFrame
    
    -- Tab Container
    window.tabContainer = Instance.new("Frame")
    window.tabContainer.Size = UDim2.new(1, -20, 1, -50)
    window.tabContainer.Position = UDim2.new(0, 10, 0, 40)
    window.tabContainer.BackgroundTransparency = 1
    window.tabContainer.Parent = window.mainFrame
    
    -- Tab Buttons Container
    window.tabButtons = Instance.new("Frame")
    window.tabButtons.Size = UDim2.new(1, 0, 0, 30)
    window.tabButtons.BackgroundTransparency = 1
    window.tabButtons.Parent = window.mainFrame
    
    function window:tab(config)
        local tab = {}
        tab.sections = {}
        tab.visible = false
        
        -- Tab Button
        tab.button = Instance.new("TextButton")
        tab.button.Text = config.name or "Tab"
        tab.button.Size = UDim2.new(0, 100, 1, 0)
        tab.button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        tab.button.TextColor3 = Color3.fromRGB(255, 255, 255)
        tab.button.Parent = window.tabButtons
        
        -- Position tabs horizontally
        local tabCount = #window.tabs
        tab.button.Position = UDim2.new(0, 110 * tabCount, 0, 0)
        
        -- Tab Content Frame
        tab.content = Instance.new("Frame")
        tab.content.Size = UDim2.new(1, 0, 1, 0)
        tab.content.BackgroundTransparency = 1
        tab.content.Visible = false
        tab.content.Parent = window.tabContainer
        
        -- Show/Hide Tab
        tab.button.MouseButton1Click:Connect(function()
            for _, otherTab in pairs(window.tabs) do
                otherTab.content.Visible = false
                otherTab.visible = false
            end
            tab.content.Visible = true
            tab.visible = true
        end)
        
        -- Show first tab by default
        if tabCount == 0 then
            tab.content.Visible = true
            tab.visible = true
        end
        
        -- Section Creation Method
        function tab:section(config)
            local section = {}
            
            -- Section Frame
            section.frame = Instance.new("Frame")
            section.frame.Size = UDim2.new(0.48, 0, 1, -10)
            section.frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
            section.frame.BorderSizePixel = 0
            
            -- Position based on side
            if config.side == "left" then
                section.frame.Position = UDim2.new(0, 5, 0, 5)
            else
                section.frame.Position = UDim2.new(0.52, 0, 0, 5)
            end
            
            -- Section Title
            section.title = Instance.new("TextLabel")
            section.title.Text = config.name or "Section"
            section.title.Size = UDim2.new(1, 0, 0, 25)
            section.title.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
            section.title.TextColor3 = Color3.fromRGB(255, 255, 255)
            section.title.Parent = section.frame
            
            -- Content Container
            section.container = Instance.new("Frame")
            section.container.Size = UDim2.new(1, -10, 1, -35)
            section.container.Position = UDim2.new(0, 5, 0, 30)
            section.container.BackgroundTransparency = 1
            section.container.Parent = section.frame
            
            section.frame.Parent = tab.content
            
            -- Method to add elements
            function section:addElement(element)
                -- This would create buttons, toggles, sliders, etc.
                -- Implementation depends on your needs
            end
            
            return section
        end
        
        table.insert(window.tabs, tab)
        return tab
    end
    
    -- Make window draggable
    local dragging = false
    local dragInput, dragStart
    
    window.title.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    window.title.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            window.mainFrame.Position = UDim2.new(
                window.mainFrame.Position.X.Scale,
                window.mainFrame.Position.X.Offset + delta.X,
                window.mainFrame.Position.Y.Scale,
                window.mainFrame.Position.Y.Offset + delta.Y
            )
        end
    end)
    
    return window
end

-- Unload Method (as you have it)
function library:unload()
    if library.gui then
        library.gui:Destroy()
    end
    for _, connection in ipairs(library.connections) do
        connection:Disconnect()
    end
    if getgenv then
        getgenv().library = nil
    end
end

-- Example Usage (as you have it)
function library:example()
    local window = library:window({
        Name = "Compact UI Example"
    })

    local tab1 = window:tab({
        name = "Tab 1"
    })

    local leftSection1 = tab1:section({
        name = "Left Section",
        side = "left"
    })

    local rightSection1 = tab1:section({
        name = "Right Section",
        side = "right"
    })
    
    -- You would typically add elements to sections here
    -- Example:
    -- leftSection1:addButton({text = "Click Me"})
end

-- Return library
return library
